---
import FullLayout from '@/layouts/FullLayout.astro'
import type { MarkdownLayoutProps } from 'astro'
import dayjs from 'dayjs'
import relativeTime from 'dayjs/plugin/relativeTime'
import type { Frontmatter, SiteMeta } from '@/types'
import { cx } from '@/lib/utils'
import '@/styles/syntaxHighlight.css'
import NoteList from '@/components/BookList.astro'

interface Props extends MarkdownLayoutProps<Frontmatter> {}

const {
  title,
  description,
  publishedAt,
  externalLink,
  updatedAt,
  tags,
  author,
  //comments = true,
  slug,
  minutesRead,
  hero,
} = Astro.props.frontmatter

const metadata: SiteMeta = {
  title: `${title}`,
  description,
  publishedAt,
}

dayjs.extend(relativeTime)
---

<FullLayout {...metadata}>
  <div class='hidden sm:flex sm:w-96'>
    <NoteList />
  </div>
  <div class='relative flex max-h-screen w-full flex-col overflow-y-auto bg-white dark:bg-black'>
    <div
      class='filter-blur sticky top-0 z-10 flex h-12 flex-col justify-center bg-white px-3 py-2 dark:border-b dark:border-gray-900 dark:bg-black'
    >
      <div class='flex flex-none items-center justify-between'>
        <span class='flex items-center space-x-3'
          ><a
            class='text-primary flex items-center justify-center rounded-md p-2 hover:bg-gray-200 dark:hover:bg-gray-800 lg:hidden'
            onclick='history.back()'
            ><svg
              xmlns='http://www.w3.org/2000/svg'
              width='16'
              height='16'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
              stroke-linecap='round'
              stroke-linejoin='round'
              class='text-primary'
              ><line x1='19' y1='12' x2='5' y2='12'></line><polyline points='12 19 5 12 12 5'
              ></polyline></svg
            ></a
          ><h2
            class='transform-gpu text-sm font-bold text-black line-clamp-1 dark:text-white'
            style='transform: translateY(200%); opacity: 0;'
          >
            {title}
          </h2></span
        ><div class='flex items-center space-x-2'></div>
      </div><div></div>
    </div>
    <div class='mx-auto w-full max-w-3xl px-4 py-12 pb-10 md:px-8'>
      <div class='mb-8 space-y-3'>
        {hero && <img class='mx-auto mb-16 h-96 rounded' loading='lazy' src={hero} alt={title} />}
        <h1 class='font-sans text-2xl font-bold xl:text-3xl'>{title}</h1>
        <div class='flex items-center justify-between md:flex-row md:items-center'>
          <div class='mt-4 flex items-center'>
            <p class='text-sm text-gray-700 dark:text-gray-300'>
              <span>Author:</span>
              <div class='ml-1 text-gray-600 dark:text-gray-200'>
                {author}
              </div>
            </p>
          </div>
        </div>

        <article
          class={cx(
            'prose dark:prose-invert max-w-none',
            'prose-hr:duration-300',
            'prose-pre:border-2 prose-pre:border-gray-200 dark:prose-pre:border-gray-700',
            'prose-code:text-pink-500'
          )}
        >
          <slot />
        </article>
        <div class='mt-6'>
          <a
            href={externalLink}
            class='shadow-xs flex flex-none cursor-pointer items-center justify-center space-x-2 rounded-lg border border-blue-600 bg-blue-500 px-4 py-3 text-sm font-semibold leading-none text-white opacity-100 transition-all hover:text-white hover:shadow-sm dark:border-blue-400 dark:border-opacity-50'
            target='_blank'
            rel='noopener noreferrer'
            ><svg
              xmlns='http://www.w3.org/2000/svg'
              width='14'
              height='14'
              viewBox='0 0 24 24'
              fill='none'
              stroke='currentColor'
              stroke-width='2'
              stroke-linecap='round'
              stroke-linejoin='round'
              ><path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path><path
                d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path></svg
            ><span>External Link to buy</span></a>
        </div>
      </div>
    </div>
  </div>
</FullLayout>
