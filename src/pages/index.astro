---
import { SEO } from 'config'
import { Image } from '@astrojs/image/components'
import avatar from '../../public/sw.webp'
import BaseLayout from '@/layouts/BaseLayout.astro'
import PostCard from '@/components/PostCard.astro'
import type { Frontmatter, SiteMeta } from '@/types'

const posts = await Astro.glob<Frontmatter>('./blog/*.mdx')
const nonDraftPosts = posts.filter(({ frontmatter }) => !frontmatter.draft)
const sortedPosts = nonDraftPosts.sort(
  ({ frontmatter: { publishedAt: a } }, { frontmatter: { publishedAt: b } }) =>
    new Date(b).valueOf() - new Date(a).valueOf()
)
  .slice(0, 3)

const pinnedPosts = sortedPosts.filter(({ frontmatter }) => frontmatter.pinned)
const unpinnedPosts = sortedPosts.filter(({ frontmatter }) => !frontmatter.pinned)

const metadata: SiteMeta = {
  title: SEO.getTitle('Blog'),
  description: 'I design experiences that make peoples lives simple.',
}
---

<BaseLayout {...metadata}>
  <div class='flex flex-col-reverse sm:flex-row sm:justify-between mb-16'>
    <div class='flex flex-col center'>
      <h1 class='text-gray-700 dark:text-gray-200 text-4xl mb-1 font-bold'>
        Hi, I'm Manuel {' '}
        <span role='img' class='wave'>ðŸ‘‹</span>
      </h1>
      <h2 class='text-lg md:text-l font-medium leading-5 mb-4'>UX Designer at EASY Software.</h2>
      <h3 class='text-gray-600 dark:text-gray-300 text-lg md:text-l'>
        I design experiences that make people's lives <span class='font-bold'>simple.</span>
      </h3>
    </div>
    <div class='relative mb-8 sm:mb-0 ml-8 flex-none'>
      <Image
        src={avatar}
        alt='Manuel Fessen'
        Ã§
        class='inline object-cover w-20 sm:w-32 h-20 sm:h-32 mr-2 rounded-full'
        draggable={false}
        loading='eager'
        format='webp'
      />
    </div>
  </div>
  <div class='space-y-6'>
    {
      !!pinnedPosts.length && (
        <>
          <h3 class='text-xl'>Pinned</h3>
          <ol class='space-y-4'>
            {pinnedPosts.map(({ frontmatter }) => (
              <li>
                <PostCard {...frontmatter} />
              </li>
            ))}
          </ol>
        </>
      )
    }
    <h3 class='text-xl'>Latest Posts</h3>
    {
      nonDraftPosts.length ? (
        <ol class='space-y-4'>
          {unpinnedPosts.map(({ frontmatter }) => (
            <li>
              <PostCard {...frontmatter} />
            </li>
          ))}
        </ol>
      ) : (
        <p class='text-gray-600 dark:text-gray-300'>No posts yet.</p>
      )
    }
  </div>
</BaseLayout>

<style>
  /* https://jarv.is/notes/css-waving-hand-emoji/ */
  .wave {
    animation-name: wave-animation;
    animation-duration: 2.667s;
    animation-iteration-count: infinite;
    transform-origin: 70% 70%;
    display: inline-block;
  }

  @keyframes wave-animation {
    0% {
      transform: rotate(0deg);
    }
    10% {
      transform: rotate(14deg);
    }
    20% {
      transform: rotate(-8deg);
    }
    30% {
      transform: rotate(14deg);
    }
    40% {
      transform: rotate(-4deg);
    }
    50% {
      transform: rotate(10deg);
    }
    60% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(0deg);
    }
  }
</style>
